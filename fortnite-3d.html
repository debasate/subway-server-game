<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Fortnite 3D - Game Hub</title>
    <style>
        body {
            margin: 0;
            background: #222c3c;
            color: #fff;
            font-family: 'Segoe UI', Arial, sans-serif;
            overflow: hidden;
        }

        #gameCanvas {
            display: block;
            margin: 0 auto;
            background: #222c3c;
            border-radius: 20px;
            box-shadow: 0 0 40px #00eaff;
        }

        #instructions {
            position: absolute;
            top: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(20, 30, 40, 0.9);
            padding: 20px 30px;
            border-radius: 15px;
            font-size: 1.2em;
            z-index: 10;
            box-shadow: 0 2px 16px #0008;
        }

        .back-btn {
            position: absolute;
            top: 30px;
            right: 40px;
            padding: 12px 32px;
            font-size: 1.1rem;
            border-radius: 8px;
            background: #232d3f;
            color: #fff;
            border: none;
            cursor: pointer;
            box-shadow: 0 2px 8px #0005;
            z-index: 10;
        }

        .back-btn:hover {
            background: #4e6fae;
        }

        #startBtn {
            margin-top: 18px;
            padding: 16px 48px;
            font-size: 1.3em;
            border-radius: 12px;
            background: #00eaff;
            color: #222c3c;
            border: none;
            cursor: pointer;
            box-shadow: 0 2px 12px #0005;
        }

        #debug {
            position: fixed;
            bottom: 10px;
            left: 10px;
            color: #fff;
            background: #000a;
            padding: 8px 16px;
            border-radius: 8px;
            z-index: 100;
            font-size: 1em;
            display: none;
        }

        #healthbar {
            position: absolute;
            top: 16px;
            left: 16px;
            width: 220px;
            height: 32px;
            background: #222c3c;
            border-radius: 8px;
            box-shadow: 0 2px 8px #0005;
            z-index: 20;
            display: none;
        }

        #healthfill {
            height: 100%;
            background: #00eaff;
            border-radius: 8px;
            width: 100%;
            transition: width 0.2s;
        }

        #healthtext {
            position: absolute;
            left: 0;
            right: 0;
            top: 0;
            bottom: 0;
            margin: auto;
            text-align: center;
            line-height: 32px;
            color: #fff;
            font-weight: bold;
            font-size: 1.1em;
        }

        #lobby {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: #232d3f;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #lobby h1 {
            color: #00eaff;
            font-size: 2.5em;
            margin-bottom: 24px;
        }

        #lobby button {
            padding: 18px 44px;
            font-size: 1.2em;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            box-shadow: 0 2px 12px #0005;
        }

        #lobby .shop-btn {
            background: #4e6fae;
            color: #fff;
        }

        #lobby .locker-btn {
            background: #00eaff;
            color: #222c3c;
        }

        #lobby .battlepass-btn {
            background: #ff4e4e;
            color: #fff;
        }

        #lobby .vbucks-btn {
            background: #ffd700;
            color: #222c3c;
        }

        #lobby #playBtn {
            padding: 20px 60px;
            font-size: 1.5em;
            border-radius: 16px;
            background: #00eaff;
            color: #222c3c;
            border: none;
            cursor: pointer;
            box-shadow: 0 2px 16px #0005;
        }

        #lobbyContent {
            margin-top: 32px;
            color: #fff;
            font-size: 1.2em;
        }
    </style>
</head>

<body>
    <div id="lobby"
        style="position:absolute;top:0;left:0;width:100vw;height:100vh;background:#232d3f;z-index:100;display:flex;flex-direction:column;align-items:center;justify-content:center;">
        <h1 style="color:#00eaff;font-size:2.5em;margin-bottom:24px;">Fortnite Lobby</h1>
        <div style="display:flex;gap:32px;margin-bottom:32px;">
            <button onclick="showShop()"
                style="padding:18px 44px;font-size:1.2em;border-radius:12px;background:#4e6fae;color:#fff;border:none;cursor:pointer;box-shadow:0 2px 12px #0005;">Shop</button>
            <button onclick="showLocker()"
                style="padding:18px 44px;font-size:1.2em;border-radius:12px;background:#00eaff;color:#222c3c;border:none;cursor:pointer;box-shadow:0 2px 12px #0005;">Locker</button>
            <button onclick="showBattlePass()"
                style="padding:18px 44px;font-size:1.2em;border-radius:12px;background:#ff4e4e;color:#fff;border:none;cursor:pointer;box-shadow:0 2px 12px #0005;">Battle
                Pass</button>
            <button onclick="showVBucks()"
                style="padding:18px 44px;font-size:1.2em;border-radius:12px;background:#ffd700;color:#222c3c;border:none;cursor:pointer;box-shadow:0 2px 12px #0005;">B-Bucks</button>
        </div>
        <button id="playBtn"
            style="padding:20px 60px;font-size:1.5em;border-radius:16px;background:#00eaff;color:#222c3c;border:none;cursor:pointer;box-shadow:0 2px 16px #0005;">Play</button>
        <div id="lobbyContent" style="margin-top:32px;color:#fff;font-size:1.2em;"></div>
    </div>
    <div id="instructions">
        <strong>Fortnite 3D - Simple Battle Royale</strong><br>
        WASD = move, Mouse = look, Left Mouse = shoot, Space = jump<br>
        Eliminate all bots to win!<br><br>
        <button id="startBtn"
            style="margin-top:18px;padding:16px 48px;font-size:1.3em;border-radius:12px;background:#00eaff;color:#222c3c;border:none;cursor:pointer;box-shadow:0 2px 12px #0005;">Start
            Game</button>
        <div id="startHelp" style="margin-top:10px;font-size:1em;color:#ff4e4e;display:none;">Klik op het canvas als het
            niet werkt!</div>
    </div>
    <button class="back-btn" onclick="window.location.href='/'">Back to Game Hub</button>
    <canvas id="gameCanvas" width="960" height="600"></canvas>
    <div id="debug"
        style="position:fixed;bottom:10px;left:10px;color:#fff;background:#000a;padding:8px 16px;border-radius:8px;z-index:100;font-size:1em;display:none">
    </div>
    <div id="healthbar"
        style="position:absolute;top:16px;left:16px;width:220px;height:32px;background:#222c3c;border-radius:8px;box-shadow:0 2px 8px #0005;z-index:20;display:none">
        <div id="healthfill" style="height:100%;background:#00eaff;border-radius:8px;width:100%;transition:width 0.2s;">
        </div>
        <span id="healthtext"
            style="position:absolute;left:0;right:0;top:0;bottom:0;margin:auto;text-align:center;line-height:32px;color:#fff;font-weight:bold;font-size:1.1em;">100
            HP</span>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/examples/js/controls/PointerLockControls.js"></script>
    <script>
        function showDebug(msg) {
            var d = document.getElementById('debug');
            d.innerText = msg;
            d.style.display = 'block';
        }
        window.onerror = function (msg, url, line, col, error) {
            showDebug('JS Error: ' + msg + ' (' + line + ':' + col + ')');
        };
        try {
            // Basic Three.js setup
            const canvas = document.getElementById('gameCanvas');
            const renderer = new THREE.WebGLRenderer({ canvas });
            renderer.setSize(canvas.width, canvas.height);
            if (!renderer.capabilities.isWebGL2 && !renderer.capabilities.isWebGL) {
                showDebug('WebGL wordt niet ondersteund in deze browser. Probeer Chrome of Edge.');
            }

            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x222c3c);

            // Camera & controls
            const camera = new THREE.PerspectiveCamera(75, canvas.width / canvas.height, 0.1, 1000);
            camera.position.set(0, 2, 10);

            const controls = new THREE.PointerLockControls(camera, canvas);

            const startBtn = document.getElementById('startBtn');
            const startHelp = document.getElementById('startHelp');
            startBtn.addEventListener('click', () => {
                document.getElementById('instructions').style.display = 'none';
                document.getElementById('gameCanvas').focus();
                controls.lock();
                setTimeout(() => {
                    if (!controls.isLocked) {
                        startHelp.style.display = '';
                    }
                }, 500);
            });
            document.getElementById('gameCanvas').addEventListener('click', () => {
                controls.lock();
                startHelp.style.display = 'none';
            });
            controls.addEventListener('lock', () => {
                document.getElementById('instructions').style.display = 'none';
                startHelp.style.display = 'none';
                document.getElementById('healthbar').style.display = '';
                updateHealthBar();
            });
            controls.addEventListener('unlock', () => {
                /* instructies blijven weg */
            });
            document.body.addEventListener('click', () => {
                document.getElementById('instructions').style.display = 'none';
                controls.lock();
            });

            // Floor
            const floorGeometry = new THREE.PlaneGeometry(40, 40);
            const floorMaterial = new THREE.MeshStandardMaterial({ color: 0x3a4a6d });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            scene.add(floor);

            // Lighting
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
            scene.add(ambientLight);
            const dirLight = new THREE.DirectionalLight(0xffffff, 0.7);
            dirLight.position.set(10, 20, 10);
            scene.add(dirLight);

            // Player
            const player = {
                mesh: new THREE.Mesh(
                    new THREE.CapsuleGeometry(0.5, 1.2, 4, 8),
                    new THREE.MeshStandardMaterial({ color: 0x00eaff })
                ),
                velocity: new THREE.Vector3(),
                canJump: true,
                health: 100
            };
            player.mesh.position.set(0, 1, 0);
            scene.add(player.mesh);

            // Bots
            const bots = [];
            for (let i = 0; i < 5; i++) {
                const bot = new THREE.Mesh(
                    new THREE.BoxGeometry(1, 2, 1),
                    new THREE.MeshStandardMaterial({ color: 0xff4e4e })
                );
                bot.position.set(
                    Math.random() * 30 - 15,
                    1,
                    Math.random() * 30 - 15
                );
                bot.health = 50;
                scene.add(bot);
                bots.push(bot);
            }

            // Obstacles
            for (let i = 0; i < 10; i++) {
                const wall = new THREE.Mesh(
                    new THREE.BoxGeometry(2, Math.random() * 4 + 2, 0.5),
                    new THREE.MeshStandardMaterial({ color: 0x6e7b8b })
                );
                wall.position.set(
                    Math.random() * 36 - 18,
                    wall.geometry.parameters.height / 2,
                    Math.random() * 36 - 18
                );
                scene.add(wall);
            }

            // Bullets
            const bullets = [];
            function shootBullet() {
                const bullet = new THREE.Mesh(
                    new THREE.SphereGeometry(0.15, 8, 8),
                    new THREE.MeshStandardMaterial({ color: 0xffff00 })
                );
                bullet.position.copy(camera.position);
                const dir = new THREE.Vector3();
                camera.getWorldDirection(dir);
                bullet.userData = { velocity: dir.multiplyScalar(0.7), life: 0 };
                scene.add(bullet);
                bullets.push(bullet);
            }

            // Controls
            const keys = {};
            document.addEventListener('keydown', e => { keys[e.code] = true; });
            document.addEventListener('keyup', e => { keys[e.code] = false; });

            // Mouse click to shoot
            document.addEventListener('mousedown', e => {
                if (controls.isLocked && e.button === 0) shootBullet();
            });

            // Toon healthbar bij start
            function updateHealthBar() {
                const hp = Math.max(0, Math.floor(player.health));
                document.getElementById('healthfill').style.width = hp + '%';
                document.getElementById('healthtext').innerText = hp + ' HP';
            }
            controls.addEventListener('lock', () => {
                document.getElementById('instructions').style.display = 'none';
                startHelp.style.display = 'none';
                document.getElementById('healthbar').style.display = '';
                updateHealthBar();
            });

            // Bot schiet terug
            function botShoot(bot) {
                const bullet = new THREE.Mesh(
                    new THREE.SphereGeometry(0.15, 8, 8),
                    new THREE.MeshStandardMaterial({ color: 0xff4e4e })
                );
                bullet.position.copy(bot.position);
                const dir = new THREE.Vector3().subVectors(player.mesh.position, bot.position).normalize();
                bullet.userData = { velocity: dir.multiplyScalar(0.5), life: 0, bot: true };
                scene.add(bullet);
                bullets.push(bullet);
            }

            // Game loop
            let lastTime = performance.now();
            function animate() {
                requestAnimationFrame(animate);
                const now = performance.now();
                const dt = Math.min((now - lastTime) / 1000, 0.05);
                lastTime = now;

                // Player movement
                if (controls.isLocked) {
                    let move = new THREE.Vector3();
                    if (keys['KeyW']) move.z -= 1;
                    if (keys['KeyS']) move.z += 1;
                    if (keys['KeyA']) move.x -= 1;
                    if (keys['KeyD']) move.x += 1;
                    move.normalize();

                    // Move in camera direction
                    const direction = new THREE.Vector3();
                    camera.getWorldDirection(direction);
                    direction.y = 0;
                    direction.normalize();

                    const right = new THREE.Vector3().crossVectors(direction, new THREE.Vector3(0, 1, 0));
                    const moveVector = new THREE.Vector3();
                    moveVector.addScaledVector(direction, move.z);
                    moveVector.addScaledVector(right, move.x);

                    player.mesh.position.addScaledVector(moveVector, 8 * dt);

                    // Gravity
                    if (player.mesh.position.y > 1) {
                        player.velocity.y -= 20 * dt;
                        player.mesh.position.y += player.velocity.y * dt;
                        if (player.mesh.position.y <= 1) {
                            player.mesh.position.y = 1;
                            player.velocity.y = 0;
                            player.canJump = true;
                        }
                    }

                    // Jump
                    if (keys['Space'] && player.canJump) {
                        player.velocity.y = 8;
                        player.canJump = false;
                    }

                    // Sync camera to player
                    camera.position.copy(player.mesh.position).add(new THREE.Vector3(0, 0.5, 0));
                }

                // Bots AI
                let lastBotShot = performance.now();
                bots.forEach(bot => {
                    // Move towards player
                    const dir = new THREE.Vector3().subVectors(player.mesh.position, bot.position);
                    dir.y = 0;
                    if (dir.length() > 2) {
                        dir.normalize();
                        bot.position.addScaledVector(dir, 2 * dt);
                    }
                    // Bots schieten
                    if (performance.now() - lastBotShot > 1200) {
                        botShoot(bot);
                        lastBotShot = performance.now();
                    }
                });

                // Bullets update
                for (let i = bullets.length - 1; i >= 0; i--) {
                    const b = bullets[i];
                    b.position.add(b.userData.velocity);
                    b.userData.life += dt;
                    if (b.userData.life > 2) {
                        scene.remove(b);
                        bullets.splice(i, 1);
                        continue;
                    }
                    // Collision with bots
                    for (let j = bots.length - 1; j >= 0; j--) {
                        const bot = bots[j];
                        if (!b.userData.bot && b.position.distanceTo(bot.position) < 1) {
                            bot.health -= 25;
                            scene.remove(b);
                            bullets.splice(i, 1);
                            if (bot.health <= 0) {
                                scene.remove(bot);
                                bots.splice(j, 1);
                            }
                            break;
                        }
                    }
                    // Collision with player
                    if (b.userData.bot && b.position.distanceTo(player.mesh.position) < 1) {
                        player.health -= 20;
                        updateHealthBar();
                        scene.remove(b);
                        bullets.splice(i, 1);
                        if (player.health <= 0) {
                            document.getElementById('instructions').innerHTML = '<strong>Game Over!</strong><br>Je bent uitgeschakeld.<br><button onclick="window.location.reload()" style="margin-top:18px;padding:16px 48px;font-size:1.3em;border-radius:12px;background:#ff4e4e;color:#fff;border:none;cursor:pointer;box-shadow:0 2px 12px #0005;">Opnieuw spelen</button>';
                            document.getElementById('instructions').style.display = '';
                            document.getElementById('healthbar').style.display = 'none';
                            controls.unlock();
                        }
                    }
                }

                // Win/Lose condition
                if (bots.length === 0) {
                    document.getElementById('instructions').innerHTML = "<strong>Victory Royale!</strong><br>You eliminated all bots!<br><button onclick=\"window.location.reload()\" style=\"margin-top:18px;padding:16px 48px;font-size:1.3em;border-radius:12px;background:#00eaff;color:#222c3c;border:none;cursor:pointer;box-shadow:0 2px 12px #0005;\">Play Again</button>";
                    document.getElementById('instructions').style.display = '';
                    document.getElementById('healthbar').style.display = 'none';
                    controls.unlock();
                }

                renderer.render(scene, camera);
            }
            animate();
        } catch (e) {
            showDebug('Fout: ' + e.message);
        }
        document.getElementById('lobby').style.display = '';
        document.getElementById('instructions').style.display = 'none';
        document.getElementById('healthbar').style.display = 'none';
        document.getElementById('gameCanvas').style.display = 'none';
        document.getElementById('playBtn').onclick = function () {
            document.getElementById('lobby').style.display = 'none';
            document.getElementById('instructions').style.display = '';
            document.getElementById('gameCanvas').style.display = '';
        };
        function showShop() {
            document.getElementById('lobbyContent').innerHTML = '<b>Shop:</b> Koop skins, emotes en meer! (Demo)';
        }
        function showLocker() {
            document.getElementById('lobbyContent').innerHTML = '<b>Locker:</b> Bekijk en selecteer je skins! (Demo)';
        }
        function showBattlePass() {
            document.getElementById('lobbyContent').innerHTML = '<b>Battle Pass:</b> Bekijk je voortgang en beloningen! (Demo)';
        }
        function showVBucks() {
            document.getElementById('lobbyContent').innerHTML = '<b>B-Bucks:</b> Je hebt <span style="color:#ffd700">1000</span> B-Bucks! (Demo)';
        }
    </script>
</body>

</html>