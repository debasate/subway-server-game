<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🍪 Cookie Clicker Game</title>
    <link rel="stylesheet" href="cookie-style.css">
</head>

<body>
    <div class="game-container">
        <!-- Header -->
        <div class="header">
            <a href="index.html" class="nav-btn back-to-hub">🏠 Game Hub</a>
            <h1>🍪 Cookie Clicker</h1>
            <div class="user-display" id="user-display" style="display: none;">
                <span id="current-user-name"></span>
            </div>
        </div>

        <!-- Main Game Area -->
        <div class="main-game">
            <!-- Cookie Display -->
            <div class="cookie-section">
                <div class="cookie-counter">
                    <div class="cookie-count" id="cookie-count">0</div>
                    <div class="cookie-label">cookies</div>
                    <div class="cookies-per-second">
                        per second: <span id="cps">0</span>
                    </div>
                </div>

                <!-- Big Cookie -->
                <div class="cookie-container">
                    <div class="big-cookie" id="big-cookie">
                        🍪
                    </div>
                    <div class="click-effects" id="click-effects"></div>
                </div>
            </div>

            <!-- Shop Section -->
            <div class="shop-section">
                <h2>🛒 Shop</h2>
                <div class="shop-container" id="shop-container">
                    <!-- Buildings will be added by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Upgrades Panel -->
        <div class="upgrades-panel">
            <h3>⬆️ Upgrades</h3>
            <div class="upgrades-container" id="upgrades-container">
                <!-- Upgrades will be added by JavaScript -->
            </div>
        </div>

        <!-- Achievements Panel -->
        <div class="achievements-panel">
            <h3>🏆 Achievements</h3>
            <div class="achievements-container" id="achievements-container">
                <!-- Achievements will be added by JavaScript -->
            </div>
        </div>

        <!-- Stats Panel -->
        <div class="stats-panel">
            <h3>📊 Statistics</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-label">Cookies baked all time:</span>
                    <span class="stat-value" id="total-cookies">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Cookies baked this game:</span>
                    <span class="stat-value" id="session-cookies">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Hand-made cookies:</span>
                    <span class="stat-value" id="hand-made">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Cookies per click:</span>
                    <span class="stat-value" id="per-click">1</span>
                </div>
            </div>
        </div>
    </div>

    <script src="cookie-game.js"></script>
    <script>
        // Check if user is logged in and display username
        function checkUserLogin() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            const userDisplay = document.getElementById('user-display');
            const userNameSpan = document.getElementById('current-user-name');

            if (currentUser) {
                userNameSpan.textContent = `👤 ${currentUser.username}`;
                userDisplay.style.display = 'block';

                // Load user-specific game data if available
                loadUserGameData(currentUser.username);
            }
        }

        // Load user-specific game data
        function loadUserGameData(username) {
            const userGameData = JSON.parse(localStorage.getItem(`cookieGame_${username}`) || 'null');
            if (userGameData) {
                // Restore game state
                cookies = userGameData.cookies || 0;
                cookiesPerSecond = userGameData.cookiesPerSecond || 0;
                cookiesPerClick = userGameData.cookiesPerClick || 1;

                // Restore upgrades
                if (userGameData.upgrades) {
                    upgrades.forEach((upgrade, index) => {
                        if (userGameData.upgrades[index]) {
                            upgrade.owned = userGameData.upgrades[index].owned || 0;
                            upgrade.cost = userGameData.upgrades[index].cost || upgrade.baseCost;
                        }
                    });
                }

                // Update display
                updateDisplay();
                updateUpgradeVisualStates();
            }
        }

        // Save user-specific game data
        function saveUserGameData() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            if (currentUser) {
                const gameData = {
                    cookies: cookies,
                    cookiesPerSecond: cookiesPerSecond,
                    cookiesPerClick: cookiesPerClick,
                    upgrades: upgrades.map(upgrade => ({
                        owned: upgrade.owned,
                        cost: upgrade.cost
                    })),
                    lastSaved: new Date().toISOString()
                };
                localStorage.setItem(`cookieGame_${currentUser.username}`, JSON.stringify(gameData));
            }
        }

        // Override the original save function to use user-specific saving
        const originalSaveGame = saveGame;
        saveGame = function () {
            saveUserGameData();
            // Also save global data for backwards compatibility
            originalSaveGame();
        };

        // Initialize user login check
        checkUserLogin();

        // Auto-save every 30 seconds
        setInterval(saveUserGameData, 30000);
    </script>
</body>

</html>